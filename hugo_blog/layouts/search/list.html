<!DOCTYPE html>
<html lang="{{ site.Language.LanguageCode }}" {{- if eq site.Language.LanguageDirection "rtl" }} dir="rtl" {{- end }}>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>{{ block "title" . }}{{ with .Params.Title }}{{ . }} | {{ end }}{{ .Site.Title }}{{ end }}</title>
    <meta name="viewport" content="width=device-width,minimum-scale=1">
    <meta name="description" content="{{ with .Description }}{{ . }}{{ else }}{{if .IsPage}}{{ .Summary }}{{ else }}{{ with .Site.Params.description }}{{ . }}{{ end }}{{ end }}{{ end }}">
    {{ hugo.Generator }}
    {{ $production := hugo.IsProduction }}
    {{ $public := not .Params.private }}
    {{ if and $production $public }}
      <meta name="robots" content="index, follow">
    {{ else }}
      <meta name="robots" content="noindex, nofollow">
    {{ end }}
    {{ with .Params.author | compare.Default .Site.Params.author }}
      {{- $author := . -}}
      {{- if reflect.IsSlice . -}}
        {{- $author = collections.Delimit . ", " | transform.Plainify -}}
      {{- end -}}
      <meta name="author" content="{{ $author }}">
    {{ end }}

    {{ partials.Include "site-style.html" . }}
    <link rel="stylesheet" href="{{ "css/custom.css" | relURL }}">
    {{ partials.Include "site-scripts.html" . }}

    {{ block "favicon" . }}
      {{ partials.IncludeCached "site-favicon.html" . }}
    {{ end }}

    {{ if .OutputFormats.Get "RSS" }}
    {{ with .OutputFormats.Get "RSS" }}
      <link href="{{ .RelPermalink }}" rel="alternate" type="application/rss+xml" title="{{ $.Site.Title }}" />
      <link href="{{ .RelPermalink }}" rel="feed" type="application/rss+xml" title="{{ $.Site.Title }}" />
      {{ end }}
    {{ end }}

    {{ if .Params.canonicalUrl }}
      <link rel="canonical" href="{{ .Params.canonicalUrl }}">
    {{ else }}
      <link rel="canonical" href="{{ .Permalink }}">
    {{ end }}

    {{/* NOTE: These Hugo Internal Templates can be found starting at https://github.com/gohugoio/hugo/tree/master/tpl/tplimpl/embedded/templates */}}
    {{- template "_internal/opengraph.html" . -}}
    {{- template "_internal/schema.html" . -}}
    {{- template "_internal/twitter_cards.html" . -}}

    {{ if hugo.IsProduction }}
      {{ template "_internal/google_analytics.html" . }}
    {{ end }}
	{{ block "head" . }}{{ partials.Include "head-additions.html" . }}{{ end }}
  </head>

  {{- $environment := hugo.Environment | compare.Default "production" -}}
  <body class="ma0 {{ $.Param "body_classes"  | compare.Default "avenir bg-near-white"}} {{ $environment }}">

    {{ block "header" . }}{{ partials.Include "site-header.html" .}}{{ end }}
    <main class="pb7" role="main">
      <div class="ph3 ph5-ns">
        <div class="cf w-100 center">
          <div class="fl w-100 pa2">
            <h1>{{ .Title }}</h1>
            <input type="text" id="search-input" placeholder="検索キーワードを入力...">
            <ul id="search-results"></ul>
          </div>
        </div>
      </div>
    </main>
    {{ partial "footer.html" . }}

    <script src="https://unpkg.com/lunr/lunr.js"></script>
    <script>
      (function() {
        var idx = lunr(function () {
          this.ref('uri');
          this.field('title', { boost: 10 });
          this.field('content');
        });

        var pages = {};

        // Fetch the search index
        fetch('{{ "index.json" | relURL }}')
          .then(response => response.json())
          .then(data => {
            data.forEach(function (page) {
              idx.add(page);
              pages[page.uri] = page;
            });
          });

        var searchInput = document.getElementById('search-input');
        var searchResults = document.getElementById('search-results');

        searchInput.addEventListener('keyup', function () {
          var query = this.value;
          var results = idx.search(query);
          displayResults(results);
        });

        function displayResults(results) {
          var ul = document.createElement('ul');
          if (results.length) {
            results.forEach(function (result) {
              var page = pages[result.ref];
              var li = document.createElement('li');
              var a = document.createElement('a');
              a.href = page.uri;
              a.textContent = page.title;
              li.appendChild(a);
              ul.appendChild(li);
            });
          } else {
            var li = document.createElement('li');
            li.textContent = '検索結果が見つかりませんでした。';
            ul.appendChild(li);
          }
          searchResults.innerHTML = '';
          searchResults.appendChild(ul);
        }
      })();
    </script>
  </body>
</html>
